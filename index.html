<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VRRefiner Maintenance</title>
  <style>
    body {
      font-family: "Times New Roman", Times, serif;
      font-size: 12px;
      background-color: #f4f7f9;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #003366;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      background-color: #ffffff;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #cccccc;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #e1ecf4;
      color: #003366;
    }

    select, textarea, input[type="date"] {
      width: 100%;
      font-family: "Times New Roman", Times, serif;
      font-size: 12px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 20px;
      background-color: #003366;
      color: white;
      border: none;
      font-size: 12px;
      cursor: pointer;
    }

    button:hover {
      background-color: #00509e;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
</head>
<body>

  <h1>VRRefiner Maintenance</h1>
  <table>
    <thead>
      <tr>
        <th>Site Name</th>
        <th>Inspection Date</th>
        <th>Device Status</th>
        <th>Issue Picture</th>
        <th>Issue Notes</th>
        <th>Work Plan</th>
        <th>Responsible Person</th>
        <th>Needed HSE Documents</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>

  <button onclick="saveChanges()">Save Changes</button>

  <script>
    // Firebase Config - replace with your actual project config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const siteNames = [
      "RUSAYL OMAN OIL 7307", "SQU", "MAABILLAH MEGA", "SEH AHMAR", "HALBAN EXPRESSWAY",
      "AL ANSAB EXPRESSWAY", "BURJ AL SAHWA", "HAY ALTADHAMUN", "SUWAIQ", "BURAIMI HW",
      "FALAJ ALQABAIL", "GHALA EXPRESSWAY", "QURUM SS", "MAWALEH CITY CENTRE SS", "ALKHUWAIR",
      "MANAL SS", "AL BURAIK", "SARFEET", "AL FATEH", "AL SAAD NEW",
      "MULADAH SS", "MIRBAT", "SHINAS FILLING STATION", "AL WADI SS", "SUSTAINABLE OASIS FS"
    ];

    const deviceStatusOptions = [
      "VRR Working well",
      "VRR not working-Needs team check & care",
      "VRR show low recovery-Needs team check & care",
      "VRR Under observation"
    ];

    const responsiblePersons = [
      "Non", "Arjun Chakramanath", "Ahmed Saif Ahmed Al Hadhrami",
      "Said Ali Salim Bait Said", "Sultan Al-Ruzaiqi", "Unni - Compressor Team"
    ];

    // Create table rows
    function buildTable() {
      const tbody = document.getElementById("table-body");
      const today = new Date().toISOString().split("T")[0];

      siteNames.forEach((site, index) => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${site}</td>
          <td><input type="date" value="${today}" /></td>
          <td>
            <select>${deviceStatusOptions.map(opt => `<option>${opt}</option>`).join("")}</select>
          </td>
          <td><input type="file" accept="image/*" /></td>
          <td><textarea></textarea></td>
          <td><textarea></textarea></td>
          <td>
            <select>${responsiblePersons.map(opt => `<option>${opt}</option>`).join("")}</select>
          </td>
          <td><textarea></textarea></td>
        `;

        tbody.appendChild(row);
      });
    }

    // Save to Firestore
    async function saveChanges() {
      const rows = document.querySelectorAll("tbody tr");
      const batch = db.batch();

      rows.forEach((row, index) => {
        const cells = row.querySelectorAll("td");
        const docRef = db.collection("vrrefiner-maintenance").doc(`site-${index}`);

        batch.set(docRef, {
          siteName: cells[0].innerText,
          inspectionDate: cells[1].querySelector("input").value,
          deviceStatus: cells[2].querySelector("select").value,
          issueNotes: cells[4].querySelector("textarea").value,
          workPlan: cells[5].querySelector("textarea").value,
          responsiblePerson: cells[6].querySelector("select").value,
          hseDocs: cells[7].querySelector("textarea").value
        });
      });

      await batch.commit();
      alert("Changes saved to Firebase!");
    }

    // Load from Firestore on startup
    async function loadData() {
      const snapshot = await db.collection("vrrefiner-maintenance").get();
      const rows = document.querySelectorAll("tbody tr");

      snapshot.forEach((doc, index) => {
        const data = doc.data();
        const cells = rows[index].querySelectorAll("td");

        cells[1].querySelector("input").value = data.inspectionDate || "";
        cells[2].querySelector("select").value = data.deviceStatus || "";
        cells[4].querySelector("textarea").value = data.issueNotes || "";
        cells[5].querySelector("textarea").value = data.workPlan || "";
        cells[6].querySelector("select").value = data.responsiblePerson || "";
        cells[7].querySelector("textarea").value = data.hseDocs || "";
      });
    }

    // Build table then load data
    window.onload = function () {
      buildTable();
      loadData();
    };
  </script>
</body>
</html>
